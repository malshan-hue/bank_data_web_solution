@using bank_data_web_models
@model IEnumerable<User>

@{
	Layout = "~/Views/Shared/_AdminDashboardLayout.cshtml";
}

<div class="container-fluid p-0">

	<h1 class="h3 mb-3 text-center">
		User List
	</h1>

	<div class="row">
		<div class="col-12 col-lg-12 col-xxl-12">
			<div class="card flex-fill">
				<div class="card-header">

					<h5 class="card-title mb-0">
						Details of Users
					</h5>
				</div>
				<table class="table table-hover my-0">
					<thead>
						<tr>
							<th>Name</th>
							<th>Email</th>
							<th>Phone</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
					</thead>
					<tbody>
						
						@foreach(var user in Model){
							<tr>
								<td>@user.UserInformation.Name</td>
								<td>@user.UserInformation.Email</td>
								<td>@user.UserInformation.Phone</td>
								@if (!user.IsDeleted)
								{
									<td><span class="badge bg-success">Active</span></td>
								}
								else{
									<td><span class="badge bg-danger">Deactivated</span></td>
								}
								<td>
                                    @if (!user.IsDeleted)
                                    {
                                        <a class="btn btn-primary btn-sm" asp-action="UserProfile" asp-controller="UserManagement" asp-area="AdminDashboard" asp-route-userName="@user.UserName">Edit</a>
                                    }
                                    else
                                    {
                                        <a class="btn btn-primary btn-sm" disabled>Edit</a>
                                    }
									<button class="btn btn-danger btn-sm deactivate-user" data-user-id="@user.UserId" data-user-name="@user.UserInformation.Email">Deactivate</button>
                                    <button class="btn btn-warning btn-sm reset-notify-user" data-user-id="@user.UserId" data-user-name="@user.UserName">Reset & Notify</button>

								</td>
								
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>

</div>

@section Scripts {
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script src="~/lib/jquery-ajax-unobtrusive/dist/jquery.unobtrusive-ajax.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script type="text/javascript">
        $(document).ready(function () {

            $('.deactivate-user').click(function () {
                var userName = $(this).data('user-name'); 

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You are about to deactivate this user!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, deactivate!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("DeactivateUser", "UserManagement", new { area = "AdminDashboard" })',
                            data: { userName: userName },
                            success: function (response) {
                                if (response.data === true) {
                                    Swal.fire(
                                        'Deactivated!',
                                        'The user has been deactivated.',
                                        'success'
                                    ).then(() => {
                                        location.reload();
                                    });
                                } else {
                                    Swal.fire(
                                        'Error!',
                                        'An error occurred while deactivating the user.',
                                        'error'
                                    );
                                }
                            },
                            error: function () {
                                Swal.fire(
                                    'Error!',
                                    'An error occurred while processing your request.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            });

            $('.reset-notify-user').click(function () {
                var userName = $(this).data('user-name');

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You are about to reset " + userName + " and notify this user!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, reset and notify!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire(
                            'Reset!',
                            'The user has been reset and notified.',
                            'success'
                        );
                    }
                });
            });

        });
    </script>
}
